{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Fenrir PC{% endblock %}</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- CSS personalizado -->
  <link href="{% static 'SistemaPedidosWebApp/css/styles.css' %}" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
</head>

<body class="d-flex flex-column min-vh-100 text-light" style="background-color: rgb(27, 27, 27);">

  <!-- HEADER TOP -->
  <div class="header_top bg-black py-2">
    <div class="container d-flex flex-column flex-lg-row align-items-center justify-content-between gap-3">

      <!-- LOGO -->
      <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'Home' %}">
        <img src="{% static 'SistemaPedidosWebApp/img/logo3.png' %}" alt="Logo">
      </a>
        
      <!-- BARRA DE BUSQUEDA -->
      <form class="search-bar d-flex flex-grow-1 mx-lg-4" role="search" action="{% url 'Tienda' %}" method="GET">
        <input class="form-control search-input"
              type="search"
              name="q"
              placeholder="Buscar productos..."
              value="{{ query|default:'' }}"
              aria-label="Buscar">
        <button class="btn search-btn" type="submit">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </form>

      <!-- BOTONES LOGIN Y REGISTRO -->
      <div class="auth-buttons d-flex align-items-center gap-2 ms-lg-auto mt-3 mt-lg-0">
        {% if user.is_authenticated %}
          <span class="fw-medium text-light">Hola {{ user.username }}</span>
          <a href="{% url 'cerrar_sesion' %}" class="logout-btn btn btn-sm btn-outline-light">Cerrar sesión</a>
        {% else %}
          <a href="{% url 'logear' %}" class="login-btn btn btn-sm btn-outline-light">Login</a>
          <a href="{% url 'Autenticacion' %}" class="register-btn btn btn-sm btn-warning text-dark">Registrate</a>
        {% endif %}
      </div>

    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark shadow-sm" 
      style="background-color: rgb(8, 8, 8); position: relative;">
    <div class="container position-relative">

        <!-- BOTÓN TOGGLE (MÓVIL) -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- =============================== -->
        <!-- LINKS CENTRADOS (solo desktop) -->
        <!-- =============================== -->
        <div class="d-none d-lg-flex position-absolute w-100 justify-content-center"
            style="left:0; top:0; height:100%; pointer-events:none;">
            
            <ul class="navbar-nav flex-row gap-3" style="pointer-events:auto;">
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Home' %}">Inicio</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Servicios' %}">Servicios</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Tienda' %}">Tienda</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Contacto' %}">Contacto</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Blog' %}">Blog</a></li>
            </ul>

        </div>

        <!-- =============================== -->
        <!-- CONTENIDO DEL COLLAPSE (móvil) -->
        <!-- =============================== -->
        <div class="collapse navbar-collapse" id="navbarContent">

            <!-- LINKS para móvil (vertical) -->
            <ul class="navbar-nav mx-auto d-lg-none text-center">
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Home' %}">Inicio</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Servicios' %}">Servicios</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Tienda' %}">Tienda</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Contacto' %}">Contacto</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'Blog' %}">Blog</a></li>

                {% if user.is_authenticated %}
                <li class="nav-item mt-2">
                    <a class="nav-link fw-semibold" href="{% url 'pedidos:mis_pedidos' %}">
                        Mis pedidos
                    </a>
                </li>
                {% endif %}
            </ul>

        </div>

        <!-- =============================== -->
        <!-- DERECHA: MIS PEDIDOS + CARRITO -->
        <!-- =============================== -->
        <ul class="navbar-nav ms-auto d-flex align-items-center" style="gap: 15px;">

            {% if user.is_authenticated %}
            <li class="nav-item d-none d-lg-block">
                <a class="nav-link fw-semibold" href="{% url 'pedidos:mis_pedidos' %}">
                    Mis pedidos
                </a>
            </li>
            {% endif %}

            <!-- CARRITO -->
            <li class="nav-item dropdown">
                <a class="nav-link fw-semibold px-3 dropdown-toggle position-relative"
                  href="#" id="carritoDropdown"
                  role="button" data-bs-toggle="dropdown" aria-expanded="false">

                    <i class="bi bi-cart3" style="font-size: 1.6rem;"></i>

                    {% if cantidad_total_carro > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ cantidad_total_carro }}
                        </span>
                    {% endif %}
                </a>

                <ul class="dropdown-menu dropdown-menu-end p-3"
                    aria-labelledby="carritoDropdown"
                    style="min-width: 320px; background: #111; color: #fff;">

                    {% if request.session.carro %}
                        
                        {% for key, item in request.session.carro.items %}
                            <li class="d-flex justify-content-between align-items-center mb-2">

                                <img src="{{ item.imagen }}" 
                                    alt="{{ item.nombre }}"
                                    style="width:50px;height:50px;object-fit:cover;border-radius:6px;margin-right:10px;">

                                <div>
                                    <strong>{{ item.nombre }}</strong><br>
                                    <small>${{ item.precio }}</small>
                                </div>

                                <div class="d-flex align-items-center">
                                    <a href="{% url 'carro:restar' item.producto_id %}"
                                      class="btn btn-sm btn-secondary px-2">-</a>

                                    <span class="mx-2">{{ item.cantidad }}</span>

                                    <a href="{% url 'carro:agregar' item.producto_id %}"
                                      class="btn btn-sm btn-secondary px-2">+</a>
                                </div>

                            </li>
                            <hr style="background:#444;">
                        {% endfor %}

                        <li class="text-center fw-bold fs-5">
                            Total: ${{ importe_total_carro }}
                        </li>

                        <li class="mt-3 d-flex justify-content-between">
                            <a href="{% url 'carro:limpiar' %}" class="btn btn-danger btn-sm">Vaciar</a>
                            <a href="{% url 'carro:realizar_pedido' %}" class="btn btn-success btn-sm">Comprar</a>
                        </li>

                    {% else %}
                        <li class="text-center">Carrito vacío</li>
                    {% endif %}
                </ul>
            </li>
        </ul>

    </div>
  </nav>




  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} text-center fw-semibold">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Contenido -->
  <main class="flex-grow-1">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="text-center py-3 mt-auto bg-black">
    <p class="mb-0">&copy; {{ year|default:2025 }} Fenrir Hardware</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://kit.fontawesome.com/c2ec05f9f8.js" crossorigin="anonymous"></script>

  {% block extra_js %}
  <script>
    // Evita que el carrito se cierre cuando clickeás adentro
    document.addEventListener("click", function (e) {
        if (e.target.closest(".dropdown-menu") || e.target.closest("#carritoDropdown")) {
            e.stopPropagation();
        }
    });
  </script>
  {% endblock %}

</body>
</html>
